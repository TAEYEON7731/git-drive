markdown# PRD: 공공데이터 포털 API 기반 음식점 정보 수집 시스템

---

## 1. 프로젝트 개요

### 1.1 목적
공공데이터 포털(식품안전나라) Open API를 활용하여 음식점 영업 정보를 자동으로 수집하고, Google 스프레드시트에 체계적으로 저장하는 시스템을 구축한다.

### 1.2 배경
- 수작업으로 음식점 정보를 수집하는 비효율성 해소
- 공공데이터 포털의 실시간 데이터 활용
- 데이터 관리 및 분석의 용이성 확보

### 1.3 범위
- 식품안전나라 API 연동
- 음식점 영업 정보 7개 항목 수집
- Google 스프레드시트 자동 입력

---

## 2. API 명세

### 2.1 API 기본 정보

**서비스명:** 인허가 업소 정보 조회 서비스 (I2500)  
**제공기관:** 식품안전나라  
**인증방식:** API Key 인증

**API 키 입력란:**
```
[여기에 발급받은 API 키를 입력하세요]
```

### 2.2 요청 URL 구조

**기본 형식:**
```
http://openapi.foodsafetykorea.go.kr/api/{인증키}/{서비스명}/{파일타입}/{시작위치}/{종료위치}
```

**실제 사용 예시:**
```
http://openapi.foodsafetykorea.go.kr/api/[YOUR_API_KEY]/I2500/json/1/100
```

**필터 조건 추가 시:**
```
http://openapi.foodsafetykorea.go.kr/api/[YOUR_API_KEY]/I2500/json/1/100/INDUTY_CD_NM=일반음식점&BSSH_NM=스타벅스
```

### 2.3 요청 파라미터

#### 필수 파라미터

| 파라미터 | 타입 | 설명 | 예시 값 |
|---------|------|------|--------|
| keyId | STRING | 인증키 | 발급받은 API Key |
| serviceId | STRING | 서비스명 (고정값) | I2500 |
| dataType | STRING | 응답 파일 타입 | json (또는 xml) |
| startIdx | STRING | 요청 시작 위치 | 1 |
| endIdx | STRING | 요청 종료 위치 | 100 |

#### 선택 파라미터 (검색 필터)

| 파라미터 | 타입 | 설명 | 예시 값 |
|---------|------|------|--------|
| LCNS_NO | STRING | 영업고유구분번호 검색 | - |
| INDUTY_CD_NM | STRING | 업종 검색 | 일반음식점, 휴게음식점 |
| BSSH_NM | STRING | 업소명 검색 | 스타벅스 |
| CHNG_DT | STRING | 최종수정일자 이후 데이터 (YYYYMMDD) | 20250101 |

### 2.4 응답 데이터

#### API 출력 필드 (7개)

| 필드명 | 한글명 | 설명 | 예시 |
|-------|--------|------|------|
| LCNS_NO | 영업고유구분번호 | 인허가번호 | 3130000-101-2023-00001 |
| INDUTY_CD_NM | 업종 | 업태 구분 | 일반음식점 |
| BSSH_NM | 업소명 | 상호명 | 행복한식당 |
| PRSDNT_NM | 대표자명 | 사업자 대표 이름 | 홍길동 |
| TELNO | 전화번호 | 연락처 | 02-1234-5678 |
| PRMS_DT | 허가일자 | 영업 허가일 | 20230315 |
| ADDR | 주소 | 전체 주소 | 서울특별시 강남구 테헤란로 123 |

---

## 3. 스프레드시트 설계

### 3.1 시트 구조

**시트명:** 음식점_데이터 (또는 사용자 지정)

### 3.2 열(Column) 구성

| 열 | 헤더명 | 데이터 소스 | 데이터 타입 | 비고 |
|----|--------|------------|-----------|------|
| A | 번호 | 자동 생성 | 숫자 | 1부터 순차 증가 |
| B | 영업고유구분번호 | LCNS_NO | 텍스트 | 인허가번호 |
| C | 업종 | INDUTY_CD_NM | 텍스트 | 업태 분류 |
| D | 업소명 | BSSH_NM | 텍스트 | 상호명 |
| E | 대표자명 | PRSDNT_NM | 텍스트 | 사업자명 |
| F | 전화번호 | TELNO | 텍스트 | 연락처 |
| G | 허가일자 | PRMS_DT | 날짜/텍스트 | YYYYMMDD 형식 |
| H | 주소 | ADDR | 텍스트 | 전체 주소 |

### 3.3 헤더 행 예시
```
A열: 번호
B열: 영업고유구분번호(인허가번호)
C열: 업종
D열: 업소명
E열: 대표자명
F열: 전화번호
G열: 허가일자
H열: 주소
```

### 3.4 데이터 예시

| A | B | C | D | E | F | G | H |
|---|---|---|---|---|---|---|---|
| 1 | 3130000-101-2023-00001 | 일반음식점 | 행복한식당 | 홍길동 | 02-1234-5678 | 20230315 | 서울특별시 강남구... |
| 2 | 3130000-101-2023-00002 | 휴게음식점 | 카페라떼 | 김영희 | 02-8765-4321 | 20230420 | 서울특별시 서초구... |

---

## 4. 기능 요구사항

### 4.1 핵심 기능

#### 4.1.1 API 연동 기능
- API 키 입력 및 검증
- HTTP 요청 생성 및 전송
- JSON 응답 파싱
- 에러 핸들링 (401, 404, 500 등)

#### 4.1.2 데이터 수집 기능
- 페이지네이션 처리 (startIdx, endIdx)
- 대용량 데이터 수집 (1,000건 이상)
- 선택적 필터 적용
- 수집 진행 상황 표시

#### 4.1.3 스프레드시트 입력 기능
- Google Sheets API 연동
- A열 자동 번호 생성 (ROW() 함수 활용 가능)
- B열부터 H열까지 데이터 순차 입력
- 헤더 행 자동 생성
- 기존 데이터 처리 옵션
  - 덮어쓰기
  - 추가하기
  - 중복 확인 후 추가

### 4.2 부가 기능

#### 4.2.1 데이터 검증
- 필수 필드 누락 체크
- 데이터 형식 검증
- 중복 데이터 확인 (인허가번호 기준)

#### 4.2.2 사용자 인터페이스
- API 키 입력란
- 데이터 범위 설정 (시작/종료 위치)
- 필터 조건 입력 (선택사항)
- 실행 버튼
- 진행 상황 표시 (프로그레스 바)
- 완료 메시지 및 결과 요약

#### 4.2.3 로깅 및 모니터링
- API 호출 이력 기록
- 에러 로그 저장
- 수집 통계 (성공/실패 건수)

---

## 5. 비기능 요구사항

### 5.1 성능
- 100건 데이터 수집: 10초 이내
- 1,000건 데이터 수집: 60초 이내
- API 호출 간격: 최소 0.5초 (Rate Limit 고려)

### 5.2 안정성
- API 호출 실패 시 재시도 로직 (최대 3회)
- 네트워크 타임아웃 설정 (30초)
- 예외 상황 처리 및 사용자 알림

### 5.3 보안
- API 키 안전한 저장 (환경변수 또는 암호화)
- HTTPS 통신
- 개인정보 처리 주의 (대표자명, 전화번호)

### 5.4 유지보수성
- 코드 모듈화
- 주석 및 문서화
- 설정값 외부화 (API URL, 필드 매핑 등)

---

## 6. 사용자 시나리오

### 6.1 기본 사용 흐름

**Step 1: 준비**
1. 공공데이터 포털에서 API 키 발급
2. Google 스프레드시트 생성 또는 기존 시트 준비

**Step 2: 설정**
1. 시스템에 API 키 입력
2. 스프레드시트 연결 (시트 ID 또는 URL)
3. 데이터 수집 범위 설정
   - 시작 위치: 1
   - 종료 위치: 100 (예시)

**Step 3: 필터 설정 (선택사항)**
- 업종 지정: "일반음식점"
- 업소명 검색: "스타벅스"
- 기준일자: 2025년 1월 1일 이후

**Step 4: 실행**
1. "데이터 가져오기" 버튼 클릭
2. 진행 상황 확인 (50% 완료...)
3. 완료 메시지 확인

**Step 5: 확인**
1. 스프레드시트 열기
2. 데이터 정확성 확인
3. 필요시 추가 수집 또는 필터 조정

### 6.2 예외 상황 처리

**케이스 1: API 키 오류**
- 에러 메시지: "유효하지 않은 API 키입니다. 확인 후 다시 시도해주세요."
- 대응: API 키 재확인 및 재입력

**케이스 2: 네트워크 오류**
- 에러 메시지: "네트워크 연결을 확인해주세요."
- 대응: 인터넷 연결 확인 후 재시도

**케이스 3: 데이터 없음**
- 메시지: "검색 조건에 맞는 데이터가 없습니다."
- 대응: 필터 조건 완화 또는 변경

---

## 7. 데이터 흐름도
```
[사용자] 
   ↓ (1) API 키 & 설정 입력
[시스템]
   ↓ (2) API 요청 생성
[식품안전나라 API]
   ↓ (3) JSON 데이터 반환
[시스템]
   ↓ (4) 데이터 파싱 & 변환
   ↓ (5) 검증 & 필터링
[Google Sheets API]
   ↓ (6) 데이터 입력
[스프레드시트]
   ↓ (7) 완료 알림
[사용자]
```

---

## 8. 구현 우선순위

### Phase 1: MVP (Minimum Viable Product)
- [ ] API 키 입력 및 저장
- [ ] 기본 API 호출 (고정 범위: 1-100)
- [ ] JSON 파싱 및 7개 필드 추출
- [ ] 스프레드시트 기본 입력 (덮어쓰기 모드)
- [ ] A열 자동 번호 생성

### Phase 2: 핵심 기능 확장
- [ ] 사용자 정의 범위 입력 (startIdx, endIdx)
- [ ] 페이지네이션 자동 처리 (1000건 이상)
- [ ] 선택적 필터 적용 (업종, 업소명)
- [ ] 진행 상황 표시
- [ ] 에러 핸들링 및 재시도

### Phase 3: 사용성 개선
- [ ] 중복 데이터 체크
- [ ] 추가 입력 모드 (기존 데이터 보존)
- [ ] 수집 이력 로그
- [ ] 데이터 내보내기 (CSV, Excel)

### Phase 4: 고급 기능
- [ ] 예약 실행 (스케줄링)
- [ ] 여러 시트 동시 관리
- [ ] 대시보드 (통계 및 시각화)
- [ ] API 사용량 모니터링

---

## 9. 제약사항 및 고려사항

### 9.1 API 제약사항
- 일일 호출 한도: 공공데이터 포털 정책 확인 필요
- 응답 속도: 네트워크 상황에 따라 변동
- 한 번에 최대 조회 가능 건수: 1,000건 (endIdx - startIdx)

### 9.2 데이터 정확성
- 공공데이터의 갱신 주기 확인 필요
- 폐업 정보 반영 여부 확인
- 주소 표기 일관성 문제 (구주소/신주소 혼재)

### 9.3 개인정보 보호
- 대표자명, 전화번호 등 개인정보 포함
- 수집 목적 명확화 및 관리 주의
- 제3자 제공 시 법적 검토 필요

### 9.4 유지보수
- API 명세 변경 시 대응 방안
- Google Sheets API 정책 변경 모니터링
- 정기적인 데이터 검증

---

## 10. 성공 지표

### 10.1 정량 지표
- 데이터 수집 성공률: 95% 이상
- 평균 처리 시간: 100건 당 10초 이내
- 에러 발생률: 5% 이하
- 중복 데이터율: 1% 이하

### 10.2 정성 지표
- 사용자 만족도: 설문조사 4.0/5.0 이상
- 시스템 안정성: 일주일 무중단 운영
- 데이터 정확성: 샘플 검증 시 95% 이상 일치

---

## 11. 부록

### 11.1 API 테스트 URL

**전체 데이터 조회 (1-10건):**
```
http://openapi.foodsafetykorea.go.kr/api/[YOUR_KEY]/I2500/json/1/10
```

**일반음식점만 조회:**
```
http://openapi.foodsafetykorea.go.kr/api/[YOUR_KEY]/I2500/json/1/10/INDUTY_CD_NM=일반음식점
```

**2025년 1월 1일 이후 변경된 데이터:**
```
http://openapi.foodsafetykorea.go.kr/api/[YOUR_KEY]/I2500/json/1/10/CHNG_DT=20250101
```

### 11.2 참고 자료
- 공공데이터 포털: https://www.data.go.kr
- 식품안전나라 Open API: https://www.foodsafetykorea.go.kr/api
- Google Sheets API 문서: https://developers.google.com/sheets/api

### 11.3 용어 정리
- **인허가번호 (LCNS_NO)**: 영업 고유 구분 번호, 각 업소의 고유 식별자
- **업종 (INDUTY_CD_NM)**: 일반음식점, 휴게음식점, 제과점 등 업태 분류
- **startIdx/endIdx**: API 페이지네이션을 위한 시작/종료 인덱스

---

## 12. 버전 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|-----|------|--------|----------|
| 1.0 | 2025-10-17 | - | 최초 작성 |

---

**문서 종료**